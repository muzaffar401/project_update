<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="admin/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>User Donations</title>
    <style>
        /* Custom CSS to center only the donation section headers */
        .center-text {
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="container mt-5">
        <h1 class="text-center my-5 text-primary">User Donations</h1>
        <div class="row">
            <div id="money-donation-records" class="col-lg-6"></div>
            <div id="food-donation-records" class="col-lg-6"></div>
        </div>
        <button id="back-button" class="btn btn-primary mb-3">Back to Admin Panel</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const selectedUser = JSON.parse(localStorage.getItem('selectedUser'));
            const moneyDonationRecords = document.getElementById('money-donation-records');
            const foodDonationRecords = document.getElementById('food-donation-records');
            const backButton = document.getElementById('back-button');

            // Back button event listener
            backButton.addEventListener('click', function () {
                window.location.href = 'index.html'; // Redirect back to the admin panel
            });

            if (!selectedUser) {
                moneyDonationRecords.innerHTML = '<p>No user selected.</p>';
                foodDonationRecords.innerHTML = '<p>No user selected.</p>';
                return;
            }

            // Display Donate Money Records
            if (selectedUser.DonateMoney && selectedUser.DonateMoney.length > 0) {
                const moneyHeader = document.createElement('h3');
                moneyHeader.textContent = 'Money Donations';
                moneyHeader.classList.add('center-text');
                moneyDonationRecords.appendChild(moneyHeader);

                selectedUser.DonateMoney.forEach((donation, index) => {
                    const donationCard = document.createElement('div');
                    donationCard.classList.add('card', 'no-border-card', 'mb-3');
                    donationCard.innerHTML = `
                        <div class="card-body">
                            <h5 class="card-title">Donation Amount: ${donation.amount}</h5>
                            <p class="card-text"><strong>Username:</strong> ${selectedUser.username}</p>
                            <p class="card-text"><strong>Name:</strong> ${donation.firstName} ${donation.lastName}</p>
                            <p class="card-text"><strong>Email:</strong> ${donation.email}</p>
                            <p class="card-text"><strong>Phone:</strong> ${donation.phone}</p>
                            <p class="card-text"><strong>Message:</strong> ${donation.message}</p>
                            ${donation.companyName ? `<p class="card-text"><strong>Company Name:</strong> ${donation.companyName}</p>` : ''}
                            ${donation.role ? `<p class="card-text"><strong>Role:</strong> ${donation.role}</p>` : ''}
                            <p class="card-text"><strong>Newsletter:</strong> ${donation.newsletter ? 'Yes' : 'No'}</p>
                            ${donation.companyName ? `<p class="card-text"><strong>Receipt:</strong> ${donation.receipt ? 'Yes' : 'No'}</p>` : ''}
                            <button class="btn btn-danger btn-sm delete-btn" data-index="${index}" data-type="money">Delete</button>
                        </div>
                    `;
                    moneyDonationRecords.appendChild(donationCard);
                });
            } else {
                const noMoneyDonations = document.createElement('p');
                noMoneyDonations.textContent = 'No money donations found for this user.';
                moneyDonationRecords.appendChild(noMoneyDonations);
            }

            // Display Donate Food Records
            if (selectedUser.DonateFood && selectedUser.DonateFood.length > 0) {
                const foodHeader = document.createElement('h3');
                foodHeader.textContent = 'Food Donations';
                foodHeader.classList.add('center-text');
                foodDonationRecords.appendChild(foodHeader);

                selectedUser.DonateFood.forEach((donation, index) => {
                    const donationCard = document.createElement('div');
                    donationCard.classList.add('card', 'no-border-card', 'mb-3');
                    donationCard.innerHTML = `
                        <div class="card-body">
                            <p class="card-text"><strong>Username:</strong> ${selectedUser.username}</p>
                            <p class="card-text"><strong>Name:</strong> ${donation.firstName} ${donation.lastName}</p>
                            <p class="card-text"><strong>Email:</strong> ${donation.email}</p>
                            <p class="card-text"><strong>Phone:</strong> ${donation.phone}</p>
                            <p class="card-text"><strong>Message:</strong> ${donation.message}</p>
                            <p class="card-text"><strong>Organization:</strong> ${donation.organization}</p>
                            <p class="card-text"><strong>Newsletter:</strong> ${donation.newsletter ? 'Yes' : 'No'}</p>
                            <button class="btn btn-danger btn-sm delete-btn" data-index="${index}" data-type="food">Delete</button>
                        </div>
                    `;
                    foodDonationRecords.appendChild(donationCard);
                });
            } else {
                const noFoodDonations = document.createElement('p');
                noFoodDonations.textContent = 'No food donations found for this user.';
                foodDonationRecords.appendChild(noFoodDonations);
            }

            // Add event listeners for delete buttons for donations
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const index = this.dataset.index;
                    const type = this.dataset.type;
                    if (confirm("Are you sure you want to delete this donation?")) {
                        if (type === 'money') {
                            selectedUser.DonateMoney.splice(index, 1);
                        } else if (type === 'food') {
                            selectedUser.DonateFood.splice(index, 1);
                        }
                        // Update localStorage
                        localStorage.setItem('selectedUser', JSON.stringify(selectedUser));
                        const users = JSON.parse(localStorage.getItem('users')) || [];
                        const userIndex = users.findIndex(user => user.username === selectedUser.username);
                        users[userIndex] = selectedUser;
                        localStorage.setItem('users', JSON.stringify(users));

                        // Remove the donation card from the DOM
                        const donationCard = this.closest('.card');
                        donationCard.remove();
                    }
                });
            });
        });
    </script>
</body>

</html>